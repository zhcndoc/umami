---
title: 在 DigitalOcean 上运行
---

[DigitalOcean](https://m.do.co/c/c9ebc1c0928d) 是一家经济实惠的云托管服务提供商，可以让你托管自己的 Umami 设置。在本安装指南中，我们将安装
[Ubuntu](https://ubuntu.com/)，一个 [PostgreSQL](https://www.postgresql.org/) 或 [MySQL](https://www.mysql.com/) 数据库，
一个 [Nginx](https://www.nginx.com/) 网络服务器，[Node.js](https://nodejs.org/) 和 Umami。
DigitalOcean 还提供了一个带有 Node.js、Ubuntu 和 Nginx 的 [NodeJS droplet 构建](https://marketplace.digitalocean.com/apps/nodejs)，能让你更快开始。

个人使用的话，你可以从每月仅需 5 美元的云服务器开始，根据需要逐步扩展。你可以使用此 **[链接](https://m.do.co/c/c9ebc1c0928d)** 
在前 60 天内获得 100 美元的额度。

请注意，这些步骤可重复用于任何提供 Ubuntu 的云托管服务。

## 安装 Ubuntu

- [Ubuntu 20.04 的初始服务器设置](https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-20-04)

## 安装数据库（PostgreSQL 或 MySQL）

- [如何在 Ubuntu 20.04 上安装 PostgreSQL](https://www.digitalocean.com/community/tutorials/how-to-install-postgresql-on-ubuntu-20-04-quickstart)
- [如何在 Ubuntu 20.04 上安装 MySQL](https://www.digitalocean.com/community/tutorials/how-to-install-mysql-on-ubuntu-20-04)

## 安装 Nginx

- [如何在 Ubuntu 20.04 上安装 Nginx](https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-ubuntu-20-04)

## 安装 Node.js

- [如何在 Ubuntu 20.04 上安装 Node.js](https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-ubuntu-20-04)

## 安装 Umami

- 请参阅 **Getting started** 中的 [安装](/docs/install)

## 运行 Umami

你可以简单地运行 `npm start` 来启动 Umami，但强烈建议你使用像 [PM2](https://pm2.keymetrics.io/) 这样的进程管理器，来帮助你处理自动重启。

使用 PM2 运行：

```shell
npm install pm2 -g
cd umami
pm2 start npm --name umami -- start
pm2 save
```

## 使用 Nginx 代理

当 Umami 运行起来后，你可以将域名或子域名的请求从 Nginx 代理到 Umami。

下面的配置会将所有来自 `umami.yourdomain.com` 的请求发送到本地的 Umami 实例。

```nginx
server {
  server_name umami.yourdomain.com;

  location / {
    proxy_pass http://localhost:3000;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }
}
```

下面的配置允许你在域名的子路径下托管 Umami（例如 website.com/stats）。
这需要在你的 `.env` 文件中设置环境变量 `BASE_PATH=/stats`。

```nginx
server {
  ...
  location /stats/_next/static/ {
    alias /your_install_location/umami/.next/static/;
    access_log off;
    expires max;
  }
  location /stats {
    proxy_pass http://127.0.0.1:3000;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }
  ...
}
```

## 添加 SSL 证书（可选）

- [如何在 Ubuntu 20.04 上使用 Let's Encrypt 保护 Nginx](https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-ubuntu-20-04)

## 完成

就是这样！你现在已经在自己的服务器上自托管了 Umami。